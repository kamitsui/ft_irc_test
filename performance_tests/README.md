## IRC サーバーの同時接続負荷テスト

### Dockerコンテナの起動とネットワーク設定
負荷テストを行う前に、IRCサーバーコンテナが適切に実行されていることを確認してください。ホストマシンからアクセスできるようにポートマッピングが必要です。
```sh
# IRCサーバーコンテナを起動する例
docker run -d --name my_irc_server -p 6667:6667 your_irc_image_name:latest
```

-d: バックグラウンドでコンテナを実行
--name my_irc_server: コンテナに名前を付ける
-p 6667:6667: ホストマシンの6667ポートをコンテナの6667ポートにマッピング

### 負荷テストツールの選択

HTTPサーバーのテストにはabやwrkが使えますが、これらはHTTPプロトコルに特化しています。IRCサーバーのテストには、IRCプロトコル（JOIN、PART、メッセージ送信など）をシミュレーションできるツールが必要です。

おすすめのツールは、Pythonで書かれた**irc-load-tester**や、独自のスクリプトでIRCクライアントを多数生成する方法です。ここでは、より制御しやすい独自のPythonスクリプトを使った方法を中心に説明します。

### 負荷テストの実行環境
負荷テストは、ホストマシン上、または別のコンテナ内から実行します。
ホストマシンから実行する場合: localhost:6667またはホストマシンのIPアドレス宛にテストを実行します。
別のDockerコンテナから実行する場合: コンテナ間のネットワークがシンプルになり、テスト環境を隔離できます。

### 具体的な負荷テスト手順（Pythonスクリプト利用）

Pythonのsocketライブラリを使って、多数のクライアント接続をシミュレートする簡単なスクリプトを作成します。

```sh
python3 irc_load_test.py
```

NUM_CLIENTS の値を100から始め、500、1000、5000と増やしていき、IRCサーバーの応答時間やエラー発生率を監視します。

### パフォーマンスの監視

```sh
# CPU使用率、メモリ使用率、ロードアベレージを監視
htop

# ネットワークトラフィックを監視
iftop -i <interface_name> # 例: iftop -i eth0

# Dockerコンテナのリソース使用状況を監視
docker stats my_irc_server
```

### まとめ

Ubuntu 22.04のDockerコンテナに対する負荷テストは、まずポートマッピングを確実に行い、次にHTTP用ではないIRCプロトコルを扱えるツール（今回はPythonスクリプト）を使って、同時接続数を段階的に増やしていくことで実現できます。ホストマシンのリソース監視を忘れずに行い、パフォーマンスのボトルネックを特定してください。
